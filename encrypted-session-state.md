Encryption of client-side session state
=======================================

Client-side session state is implemented as a set of cookies. A valid non-empty session state will contain 1 `session secret key` cookie and zero-to-many `application data` cookies.

'session secret key' cookie structure
-------------------------------------

The singleton `session secret key` cookie (`CookieName -> CookieValue`) is generated by:

    Hash(ApplicationConstant) -> [IV, SymmetricEncryption(IV, ApplicationSecretKey, [CookieName, SessionSecretKey])]

*Expanded:*

    Cookie                = [CookieName, CookieValue]

    CookieName            = Hash(ApplicationConstant)
    ApplicationConstant   = "FE291934-66BD-4500-B27F-517C7D77F26B"
    Hash                  = SHA-1(<clear text>)

    CookieValue           = [IV, CookieValueCipherText]
    CookieValueCipherText = SymmetricEncryption(IV, ApplicationSecretKey, CookieValueClearText)
    CookieValueClearText  = [CookieName, SessionSecretKey]
    ApplicationSecretKey  = SecureRandom128Bit() // Generated once and stored in application config
    SessionSecretKey      = SecureRandom128Bit()
    IV                    = SecureRandom128Bit()
    SymmetricEncryption   = AES-128(<initialization vector>, <secret key>, <clear text>)

'application data' cookie structure
-----------------------------------

An `application data` cookie (`CookieName -> CookieValue`) is generated by:

    Hash([SessionSecretKey, CookieNameClearText]) -> [IV, SymmetricEncryption(IV, SessionSecretKey, [CookieName, Payload])]

*Expanded:*

    Cookie                = [CookieName, CookieValue]

    CookieName            = Hash([SessionSecretKey, CookieNameClearText])
    SessionSecretKey      = <obtained from 'session secret key' cookie>
    Hash                  = SHA-1(<clear text>)

    CookieValue           = [IV, CookieValueCipherText]
    CookieValueCipherText = SymmetricEncryption(IV, SessionSecretKey, CookieValueClearText)
    CookieValueClearText  = [CookieName, Payload]
    IV                    = SecureRandom128Bit()
    SymmetricEncryption   = AES-128(<initialization vector>, <secret key>, <clear text>)
